<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="HotShot: A linear time, committee electing, BFT Protocol."><title>hotshot::documentation - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-9ee3a5e31a2afa3e.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="hotshot" data-themes="" data-resource-suffix="" data-rustdoc-version="1.75.0 (82e1608df 2023-12-21)" data-channel="1.75.0" data-search-js="search-8fbf244ebcf71464.js" data-settings-js="settings-74424d7eec62a23e.js" ><script src="../../static.files/storage-fec3eaa3851e447d.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-9dd44ab47b99a0fb.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-5d8b3c7633ad77ba.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../hotshot/index.html">hotshot</a><span class="version">0.3.3</span></h2></div><h2 class="location"><a href="#">Module documentation</a></h2><div class="sidebar-elems"><h2><a href="../index.html">In crate hotshot</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">hotshot</a>::<wbr><a class="mod" href="#">documentation</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/hotshot/documentation.rs.html#2-19">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="hotshot-a-linear-time-committee-electing-bft-protocol"><a href="#hotshot-a-linear-time-committee-electing-bft-protocol">HotShot: A linear time, committee electing, BFT Protocol.</a></h2><h3 id="table-of-contents"><a href="#table-of-contents">Table of contents</a></h3>
<ol>
<li><a href="#background">Background</a></li>
<li><a href="#protocol-overview">Protocol Overview</a>
<ol>
<li><a href="#basics">Basics</a>
<ul>
<li><a href="#view-timeouts">View Timeouts</a></li>
</ul>
</li>
<li><a href="#sequential">Sequential HotShot</a>
<ul>
<li><a href="#sequential-leader">ValidatingLeader</a></li>
<li><a href="#sequential-replica">Replica</a></li>
</ul>
</li>
<li><a href="#pipelined">Pipelined HotShot</a></li>
</ol>
</li>
<li><a href="#appendices">Appendices</a>
<ol>
<li><a href="#definitions">Definitions</a>
<ol>
<li><a href="#quorum-certificate">Quorum Certificate</a></li>
<li><a href="#safe-node-predicate">Safe Node Predicate</a></li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="background"><a href="#background">Background</a></h2>
<p>HotShot is a hybrid, committee electing, Proof of Stake protocol for the partially synchronous model that exhibits
optimistic responsiveness and linear communication footprint.</p>
<p>HotShot’s construction borrows heavily from the construction of <a href="https://arxiv.org/abs/1803.05069">Hotstuff</a> and
<a href="https://people.csail.mit.edu/nickolai/papers/gilad-algorand-eprint.pdf">Algorand</a>, in many senses being a synthesis of
Hotstuff’s protocol with Algorand’s sortition.</p>
<h2 id="protocol-overview"><a href="#protocol-overview">Protocol Overview</a></h2>
<p>HotShot comes in two variants, <a href="#pipelined">Pipelined HotShot</a> and <a href="#sequential">Sequential HotShot</a>.
Sequential HotShot is the simpler of the two variants, and is the basal form, from which Pipelined HotShot is
derived, so it will be discussed first.</p>
<h3 id="basics"><a href="#basics">Basics</a></h3>
<p>The operation of HotShot is divided in to a sequence of discrete epoch, referred to as
‘views’. Each view is assigned an integer index (represented as a <a href="https://doc.rust-lang.org/1.75.0/std/primitive.u64.html" title="primitive u64"><code>u64</code></a>) starting with 0, which is
monotonically increasing.</p>
<p>In each view number, a singe node is designated the ‘leader’<sup id="fnref1"><a href="#fn1">1</a></sup>, and is responsible for driving
consensus for that round. The leader changes with each view number, and every caught-up node
independently calculates who they think the leader is, without communication.</p>
<p>For the sake of simplicity, the leaders are not described as voting, however, the leader in a given
view additionally performs all the actions that a replica would, in addition to its own, including
voting.</p>
<p>All nodes maintain an internal reference to a Quorum Certificated called the LockedQC, which is
updated when the node commits a Leaf. Nodes will only accept leaves that extend from their LockedQC
<em>or</em> leaves that extend from a QC with a view number higher than that of any QC the node has seen.</p>
<h4 id="view-timeouts"><a href="#view-timeouts">View Timeouts</a></h4>
<p>The particular method a node uses to determine if a round has timed out is not important for safety,
but is critical for liveness.</p>
<p>Currently, nodes apply an approach where the timeout normally takes on a set value, but engages in
exponential back-off when a round fails, ensuring that <em>eventually</em> enough nodes will been in the
same view number to complete a round.</p>
<p>At present, when a round does successfully complete, the timeout is immediately dropped all the way
back down to the set timeout value.</p>
<p>As the protocol exhibits optimistic responsiveness<sup id="fnref2"><a href="#fn2">2</a></sup>, there is little detriment to setting the
base value for timeouts higher than is strictly necessary.</p>
<h3 id="sequential"><a href="#sequential">Sequential</a></h3><p align="center">
<img src="./img/basic_hotstuff.svg" />
</p>
<p align="center"><i>Figure 1: Sequential HotShot. During each view, a new leader is elected and four stages are required before a replica can extend its blockchain with one block.</i></p>
<br /><br />
<p>Sequential HotShot does not currently support committee election or dynamically updating the
membership list, instead using a predefined list of participant nodes with equal weights. Sequential
HotShot is essentially identical to <a href="https://arxiv.org/pdf/1803.05069.pdf">Basic HotStuff</a>.</p>
<p>Each view of Sequential HotShot is divided into 4 stages the specifics of which depend on if the
node is the leader or a replica. Upon either reviving a commit QC in a round, or the round timing
out, a node will calculate the next leader, and send a NewView message for the next view number to
it, tagged with the nodes current prepareQC.</p>
<h4 id="sequential-leader"><a href="#sequential-leader">Sequential Leader</a></h4>
<ol>
<li>
<p>Prepare</p>
<p>In this phase, the leader:</p>
<ul>
<li>Waits to receive NewView messages from at least <code>2f + 1</code> nodes</li>
<li>Selects the highest view-numbered Quorum Certificate from among the NewView messages to build
off of (HighQC),</li>
<li>Creates a new Leaf building off of the HighQC, containing the transactions in the leader’s
mempool, tagged with the HighQC as its justification QC</li>
<li>Broadcasts the new Leaf to the network as a proposal</li>
</ul>
</li>
<li>
<p>Pre-Commit</p>
<p>In this phase, the leader:</p>
<ul>
<li>Waits to receive at least <code>2f + 1</code> Votes (partial signatures) on its proposal from the Prepare
phase</li>
<li>Packages the votes into a Quorum Certificate marked as originating in the Prepare phase</li>
<li>Broadcasts the Quorum Certificate to the network</li>
</ul>
</li>
<li>
<p>Commit</p>
<p>In this phase, the leader:</p>
<ul>
<li>Waits to receive at least <code>2f + 1</code> Votes on the Quorum Certificate from the previous phase</li>
<li>Packages the votes into a Quorum Certificate marked as originating in the Pre-Commit Phase</li>
<li>Broadcasts the Quorum Certificate to the network</li>
</ul>
</li>
<li>
<p>Decide</p>
<p>In this phase, the leader:</p>
<ul>
<li>Waits to receive at least <code>2f + 1</code> Votes on the Quorum Certificate from the previous phase</li>
<li>Packages the votes into a Quorum Certificate marked as originating in the Commit Phase</li>
<li>Broadcasts the Quorum Certificate to the network</li>
</ul>
</li>
</ol>
<h4 id="sequential-replica"><a href="#sequential-replica">Sequential Replica</a></h4>
<ol>
<li>
<p>Prepare</p>
<p>In this phase, the replica:</p>
<ul>
<li>Waits for a proposal from the leader for the current view</li>
<li>Verifies that the proposal contains a valid block</li>
<li>Verifies that the proposal extends from the proposal’s justification QC</li>
<li>Verifies that the proposal satisfies the safe node predicate</li>
<li>Generates a vote (partial signature) for the proposal for the prepare phase</li>
<li>Sends the vote to the leader</li>
</ul>
</li>
<li>
<p>Pre-Commit</p>
<p>In this phase, the replica:</p>
<ul>
<li>Waits for a Prepare QC from the leader</li>
<li>Generates a vote for the proposal for the pre-commit stage</li>
<li>Sends the vote to the leader</li>
</ul>
</li>
<li>
<p>Commit</p>
<p>In this phase, the replica:</p>
</li>
</ol>
<ul>
<li>Waits for a Pre-Commit QC from the leader</li>
<li>Generates a vote for the proposal for the commit stage</li>
<li>Sends the vote to the leader</li>
</ul>
<ol start="4">
<li>
<p>Decide</p>
<p>In this phase, the replica:</p>
</li>
</ol>
<ul>
<li>Waits for the Commit QC from the node</li>
<li>Executes the commands between the previously committed Leaf and the one in the proposal for this
view</li>
</ul>
<h3 id="pipelined"><a href="#pipelined">Pipelined</a></h3><p align="center">
<img src="./img/chained_hotstuff.svg" />
</p>
<p align="center"><i>Figure 2: Pipelined HotShot. The four stages (Prepare,Pre-Commit, Commit and Decide) are run in parallel across consecutive proposals.</i></p>
<br /><br />
<p>One of the limitations of the sequential version of HotShot is that 3 rounds of interactions are needed before
a leader can commit a block. In order to increase the throughput and latency one can do the following:</p>
<ul>
<li>Have replicas handle the different stages (<em>Prepare</em>, <em>Pre-Commit</em>, <em>Commit</em>, <em>Decide</em>) yielding an update of the blockchain
state in “parallel” for consecutive/chained proposals during each view.</li>
<li>Let leaders delegate the responsibility to move their initial proposal (Prepare) to the next stages
to the subsequent leaders/groups of replicas.</li>
</ul>
<p>So in practice during each view <em>n</em>, a leader will propose a new extension to the blockchain, while
the replicas will update their internal state based on proposals made during the view <em>n</em> but also views <em>n-1</em>, <em>n-2</em>, and <em>n-3</em>.
As shown in Figure 2, during <em>view n</em> the following happens:</p>
<ol>
<li>The leader proposes an extension <em>cmd n</em> to the state. This extension is based on the node propose by the previous leader during view <em>n-1</em></li>
<li>Each replica send their vote to the next view leader for the new proposal.</li>
<li>If it is possible, each replica will run the instructions of the <em>pre-commit</em> stage for the proposal made during view <em>n-1</em>.</li>
<li>If it is possible, each replica will run the instructions of the  <em>commit</em> stage for the proposal made during view <em>n-2</em>.</li>
<li>If it is possible, each replica will run the instructions of the <em>decide</em> stage for the proposal during view <em>n-3</em>.</li>
</ol>
<p>With the pipelined protocol, in case there are no failures, a new block will be committed at the end
of each view, which in this case involves only one interaction between each replica and the leader instead of
3 for the sequential version.</p>
<h3 id="cryptographic-sortition"><a href="#cryptographic-sortition">Cryptographic sortition</a></h3>
<p>In order to make HotShot permissionless, we rely on
the cryptographic sortition algorithm introduced in the <a href="https://people.csail.mit.edu/nickolai/papers/gilad-algorand-eprint.pdf">Algorand</a> paper
(see Section 5).</p>
<p>The goal of this algorithm is to dynamically select a committee of small size in order to produce the next view.
Members of this committee use a Verifiable Random Function (VRF) in order to prove they have been elected for participating in the view.
The probability of being elected is proportional to the stake of each member.</p>
<p>Note that in HotShot the leader is not chosen by cryptographic sortition like in Algorand but defined in a deterministic manner
as in Hotstuff.
Thus, our implementation of cryptographic sortition slightly differs from the Algorand’s one (in particular the VRF does not take the <em>role</em> as input).</p>
<h2 id="appendices"><a href="#appendices">Appendices</a></h2><h3 id="definitions"><a href="#definitions">Definitions</a></h3><h4 id="quorum-certificate"><a href="#quorum-certificate">Quorum Certificate</a></h4>
<p>A Quorum Certificate is a threshold signature of a <a href="hotshot_types::data::Leaf"><code>Leaf</code></a>, composed of
signatures from at least <code>2f + 1</code> nodes.</p>
<p>In the case of sequential HotShot, or pipelined HotShot without committee election, <code>f</code> is
defined to be the maximum number of faulty nodes the network can tolerate.</p>
<p>In the case of pipelined HotShot with committee election, <code>f</code> is defined to be the maximum number
of faulty committee seats the network can tolerate.</p>
<h4 id="safe-node-predicate"><a href="#safe-node-predicate">Safe Node Predicate</a></h4>
<p>The safe node predicate can be defined using the following rust-like pseudo-code</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="kw">fn </span>safe_node(
    hot_shot: HotShot,
    proposal_node: Leaf,
    proposal_justifcation: QuorumCertificate,
) -&gt; bool {
    <span class="kw">let </span>safety_rule = proposal_node.extends_from(hot_shot.locked_qc);
    <span class="kw">let </span>liveness_rule = proposal_justifcation.view_number &gt; hot_shot.locked_qc;
    safety_rule || liveness_rule
}</code></pre></div>
<p>In essence, a node is safe if it either extends from the nodes current locked_qc, <em>or</em> contains a
justification quorum certificate with a view number higher than that of the node’s current
locked_qc.</p>
<div class="footnotes"><hr><ol><li id="fn1"><p>Though, it should be noted, that it technically valid for the election process to specify
arbitrarily many leaders for a round, but at most one of them will be able to make progress&nbsp;<a href="#fnref1">↩</a></p></li><li id="fn2"><p>The network will complete a view and move on to the next one as fast as network conditions,
irrespective of the timeout value for the round&nbsp;<a href="#fnref2">↩</a></p></li></ol></div></div></details></section></div></main></body></html>